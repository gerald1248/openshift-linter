function mainFunc(){var t=new App;t.init()}var App=function(){this.counter=0,this.init=function(){var t=this;this.storageGetter(),$("#update-button").on("click",function(){t.storageSetter(),t.get()}),$("#create-report-button").on("click",function(){t.storageSetter(),t.post()}),this.clipboard=new Clipboard("#copy-button"),this.clipboard.on("error",function(t){}),$("#modal-action-button").on("click",function(){t.sideload()}),$("#sideload-modal").on("shown.bs.modal",function(){$("#modal-source").focus()}),$("#charts").css({display:"none"})},this.post=function(){var t=this,e={};try{e=JSON.parse($("#data").val())}catch(t){return void $("#report").text("Can't parse JSON data")}var a=$("#namespace-label").val(),r=$("#namespace-pattern").val(),n=$("#name-pattern").val(),o=$("#container-pattern").val(),s=$("#env-pattern").val();a.length>0&&(e.customNamespaceLabel=a),r.length>0&&(e.customNamespacePattern=r),n.length>0&&(e.customNamePattern=n),o.length>0&&(e.customContainerPattern=o),s.length>0&&(e.customEnvPattern=s),$.ajax({url:"/openshift-linter",type:"POST",data:JSON.stringify(e),dataType:"json",contentType:"application/json; charset=utf-8",success:function(e){return"object"!=typeof e?void($("#report")[0].innerHTML=e):void($("#report")[0].innerHTML=t.formatReport(e))},error:function(t){$("#report")[0].innerHTML="POST request failed"}})},this.drawChartSummary=function(t){var e=$("#canvas01"),a=t.summary,r=[a.g?a.g.length:0,a.ga?a.ga.length:0,a.a?a.a.length:0,a.ar?a.ar.length:0,a.r?a.r.length:0];new Chart(e,{type:"pie",data:{labels:["No issues","1 issue","2 issues","3 issues","4 or more issues"],datasets:[{data:r,backgroundColor:["rgba(0, 255, 0, 1.0)","rgba(127, 255, 0, 1.0)","rgba(255, 255, 0, 1.0)","rgba(255, 127, 0, 1.0)","rgba(255, 0, 0, 1.0)"],borderColor:["rgba(0, 255, 0, 1.0)","rgba(127, 255, 0, 1.0)","rgba(255, 255, 0, 1.0)","rgba(255, 127, 0, 1.0)","rgba(255, 0, 0, 1.0)"],borderWidth:1}]},options:{responsive:!1}})},this.drawChartIssueType=function(t){var e=$("#canvas02"),a=[],r=[],n=[],o=0;keys=Object.getOwnPropertyNames(t);for(var s=0;s<keys.length;s++){var l=keys[s];if("summary"!==l){var i=this.countChildren(t[l]);a.push(l),r.push(i),i>o&&(o=i)}}for(s=0;s<r.length;s++){var i=r[s];if(0===i||0===o)n.push("rgba(0, 255, 0, 1.0)");else{var c=100*i/o,p=Math.abs(c-100),u=Math.round(p);n.push("hsl("+u+",100%,50%)")}}new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:"occurrences",data:r,backgroundColor:n,borderColor:n,borderWidth:0}]},options:{responsive:!1,legend:{display:!1}}})},this.countChildren=function(t){var e=0;for(key in t)if(t.hasOwnProperty(key)){if(!t[key])continue;e+=t[key].length}return e},this.formatReport=function(t){var e="";for(key in t)if("summary"!==key&&t[key])for(subkey in t[key])if(t[key][subkey]){var a=t[key][subkey],r=a.length;if(0!==r&&(plural=1===r?"":"s",e+="<h3>"+key+": "+subkey+" ("+r+" item"+plural+")</h3>",1!==r||""!==a[0].Namespace||""!==a[0].Name||""!==a[0].Container)){e+="<table class='table table-striped'>",e+="<thead class='thead-default'><tr><th>Namespace</th><th>Name</th><th>Container</th></tr></thead>";for(var n=0;n<r;n++)e+="<tr><td>"+this.nonBlank(a[n].Namespace)+"</td><td>"+this.nonBlank(a[n].Name)+"</td><td>"+this.nonBlank(a[n].Container)+"</td></tr>";e+="</table>"}}return e},this.nonBlank=function(t){return 0===t.length?"&ndash;":t},this.get=function(){var t=$("#master-input").val(),e=$("#port-input").val(),a=$("#token-input").val(),r=$("#request-input").val(),n=t+":"+e+r;$.ajax({url:n,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8",headers:{Authorization:"Bearer "+a},success:function(t){$("#data").val(JSON.stringify(t)),$("#error")[0].innerHTML=""},error:function(t){var e=t.responseJSON?t.responseJSON.message:t.statusText;$("#error")[0].innerHTML=e}})},this.sideload=function(){var t=$("#modal-source")[0].value;try{var e=JSON.parse(t)}catch(t){return void($("#report")[0].innerHTML=t.message)}e!=={}&&null!==e&&"undefined"!=typeof e||($("#report")[0].innerHTML="No data"),$("#charts").css({display:"block"}),this.drawChartSummary(e),this.drawChartIssueType(e),$("#report")[0].innerHTML=this.formatReport(e)},this.storageGetter=function(){"undefined"!=typeof localStorage&&($("#master-input").val(localStorage.getItem("master")),$("#port-input").val(localStorage.getItem("port")),$("#token-input").val(localStorage.getItem("token")),$("#request-input").val(localStorage.getItem("request")),$("#namespace-pattern").val(localStorage.getItem("namespace-pattern")),$("#name-pattern").val(localStorage.getItem("name-pattern")),$("#container-pattern").val(localStorage.getItem("container-pattern")),$("#env-pattern").val(localStorage.getItem("env-pattern")),$("#data").val(localStorage.getItem("data")),$("#modal-source").val(localStorage.getItem("report")))},this.storageSetter=function(){"undefined"!=typeof localStorage&&(localStorage.setItem("master",$("#master-input").val()),localStorage.setItem("port",$("#port-input").val()),localStorage.setItem("token",$("#token-input").val()),localStorage.setItem("request",$("#request-input").val()),localStorage.setItem("namespace-pattern",$("#namespace-pattern").val()),localStorage.setItem("name-pattern",$("#name-pattern").val()),localStorage.setItem("container-pattern",$("#container-pattern").val()),localStorage.setItem("env-pattern",$("#env-pattern").val()),localStorage.setItem("data",$("#data").val()),localStorage.setItem("report",$("#modal-source").val()))}};window.onload=mainFunc;